$(document).load(function(){}).ready(function(){function e(e,t){var i=new Date;i.setTime(i.getTime()+864e5),document.cookie=e+"="+t+";expires="+i.toUTCString()}function t(e){return e.toLowerCase().replace(/[^\w ]+/g,"+").replace(/ +/g,"-")}function r(e){return e.name+" - "+e.text}function a(e){return"<a onclick=\"window.open('http://vimeo.com/"+e.text+'\')" href="#">'+e.text+"</a>"}function o(e){return phone=e.text.replace(/[^\d]/g,""),10==phone.length?phone.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):"nr gresit: "+e.text}$(".howmany").bind("enterKey",function(){e("admin-howmany",$(this).val()),location.reload(!0)}),$(".howmany").keyup(function(e){13==e.keyCode&&$(this).trigger("enterKey")});var n=new MediumEditor(".providerEditor",{disableDoubleReturn:!1,disableToolbar:!0,cleanPastedHTML:!0,targetBlank:!0}),l=$("#providerHtml");l.length>0&&l.val().length>0&&$(".providerEditor").html(l.val()),$("#saveUser").click(function(e){e.preventDefault(),$("#userForm").submit()}),$("#saveProvider").click(function(e){if(e.preventDefault(),$("#formprovider").valid()){var t=$("<input>").attr("type","hidden").attr("name","description").val(n.serialize()["element-0"].value);$("#formprovider").append($(t)),"checked"===$("#publicView").attr("checked")?$("#publicView").val(!0):($("#publicView").attr("checked",!0),$("#publicView").val(!1)),$("#formprovider").submit()}}),$('.formblog button[type="submit"]').click(function(){var e=$("#newBlogPost").serializeArray();e.push({name:"body",value:c.serialize()["element-0"].value}),$.post("/admin/blog/new",e,function(){console.log("success")}).done(function(){console.log("done - success"),window.location="/admin/blog"}).fail(function(){console.log("error inserting blog post")}).always(function(){console.log("always triggered on finished")})}),$("#deleteProvider").click(function(e){e.preventDefault();var t;confirm("Esti sigur ca vrei sa stergi furnizorul?")&&(t="/admin/providers/delete/"+$("#idProvider").val(),$.post(t).done(function(){window.location="/admin/providers"}).fail(function(){console.log("eroare la stergerea provider-ului din calea "+t)}))}),$(".providerNameInput").blur(function(){var e=$(this).val();$('input[name="url"]').val(t(e))}),$("#deleteUser").click(function(e){var t;e.preventDefault(),confirm("Esti sigur ca vrei sa stergi user-ul?")&&(t="/admin/users/delete/"+$("#idUser").val(),$.post(t).done(function(){console.log("success"),window.location="/admin/users"}).fail(function(){console.log("eroare la stergerea user-ului din calea "+t)}))});var s=$("#hiddenHtml");s.length>0&&s.val().length>0&&$(".mediumblog").html(s.val());var c=new MediumEditor(".mediumblog",{disableDoubleReturn:!0,buttons:["bold","italic","anchor","header2","quote"]});$(".mediumblog").mediumInsert({editor:c,addons:{images:{imagesUploadScript:"/uploadimage"},embeds:{urlPlaceholder:"adresa web a imaginii"}}});$("#e10").select2({data:[{id:0,text:"enhancement"},{id:1,text:"bug"},{id:2,text:"duplicate"},{id:3,text:"invalid"},{id:4,text:"wontfix"}]}),$("#selectUserRoles").select2({placeholder:"Alege rolurile",maximumSelectionSize:5,multiple:!0,formatAjaxError:"eroare in citirea rolurilor",formatInputTooShort:"prea putine caractere introduse",data:[{id:"admin",text:"admin"},{id:"editor",text:"editor"}],initSelection:function(e,t){var r=[],a=$(e).val().split(",");for(i=0;i<a.length;i++)r.push({id:a[i],text:a[i]});t(r)}}),$("#category").length&&$.ajax({url:window.location.protocol+"//"+window.location.host+"/querycategories",type:"GET",dataType:"json",error:function(){},success:function(e){var t=[];for(i=0;i<e.categories.length;i++)t.push({id:e.categories[i],text:e.categories[i]});$("#category").select2({placeholder:"Alege categoria",maximumSelectionSize:1,placeholder:"categorie",formatAjaxError:"eroare in citirea categoriilor",formatInputTooShort:"prea putine caractere introduse",data:t,initSelection:function(e,t){var i=$(e).val(),r={id:i,text:i};t(r)},createSearchChoice:function(e){return{id:e,text:e}}})}}),$("#selectUsersAsAdmin").select2({minimumInputLength:2,formatResult:r,formatSelection:r,placeholder:"userii care administreaza",formatAjaxError:"eroare in citirea userilor",formatInputTooShort:"prea putine caractere introduse",multiple:!0,ajax:{url:"/queryusers",dataType:"json",data:function(e){return{q:e,page_limit:10}},results:function(e){var t={results:[]};for(i=0;i<e.users.length;i++)t.results.push({id:e.users[i]._id,text:e.users[i].email,name:e.users[i].name});return t}},initSelection:function(e,t){var r=$(e).val().split(",");$.ajax({url:window.location.protocol+"//"+window.location.host+"/usersbyid",type:"POST",dataType:"json",data:{ids:r},error:function(e){t(e)},success:function(e){var r=[];for(i=0;i<e.length;i++)r.push({id:e[i]._id,text:e[i].email,name:e[i].name});t(r)}})}}),$("#selectVimeoIdList").select2({formatSelection:a,placeholder:"id-uri vimeo",multiple:!0,tags:function(){var e=$("#selectVimeoIdList").val().split(",");return e}}).on("change",function(e){0==e.val.length&&$("#vimeoId").select2("data",null)}),$("#vimeoId").select2({maximumSelectionSize:1,placeholder:"id-uri vimeo",data:function(){var e=$("#selectVimeoIdList").val().split(","),t=[];for(i=0;i<e.length;i++)t.push({id:e[i],text:e[i]});return{results:t}}}),$("#selectPhoneNumbers").select2({formatSelection:o,multiple:!0,tags:function(){return $("#selectPhoneNumbers").val().split(",")}});var u=$("#formprovider").validate({onkeyup:!1,errorClass:"formErrorClass",ignore:[],errorPlacement:function(e,t){$(t);e.insertAfter(t)},highlight:function(e,t){var i=$(e);i.hasClass("select2-offscreen")?$("#s2id_"+i.attr("id")+" a").addClass(t):i.addClass(t)},unhighlight:function(e,t){var i=$(e);i.hasClass("select2-offscreen")?$("#s2id_"+i.attr("id")+" a").removeClass(t):i.removeClass(t)},submitHandler:function(e){e.submit()},invalidHandler:function(e,t){t.numberOfInvalids()&&$("html, body").animate({scrollTop:$(t.errorList[0].element).offset().top-80},400)},rules:{name:{required:!0,minlength:3},category:{required:!0,minlength:3},url:{required:!0,minlength:3},activeSince:{date:!0},activeTo:{date:!0},"contact[address]":{minlength:8}},messages:{name:{required:"Furnizorul trebuie sa aiba un nume.",minlength:"Nu mai putin de 3 caractere!"},category:{required:"Ne trebuie o categorie.",minlength:"Nu mai putin de 3 caractere!"},activeSince:{date:"Introdu o data valida!"},activeTo:{date:"Introdu o data valida!"},"contact[address]":{minlength:"Adresa de minim 8 caractere!"}}});$(document).on("change",".select2-offscreen",function(){u.form()}),$(document).on("select2-opening",function(e){var t=$(e.target);$("#s2id_"+t.attr("id")+" a").hasClass("myErrorClass")?$(".select2-drop a").addClass("myErrorClass"):$(".select2-drop a").removeClass("myErrorClass")})});